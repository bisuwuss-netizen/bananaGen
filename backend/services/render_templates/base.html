<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ deck_title }}</title>

    <!-- Reveal.js æ ¸å¿ƒæ ·å¼ (æœ¬åœ°/ç¦»çº¿å…¼å®¹) -->
    <link rel="stylesheet" href="./static/reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="./static/reveal.js/dist/theme/white.css">

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="./static/css/vocational.css">
    <link rel="stylesheet" href="./static/css/image-slot.css">

    <style>
        /* CSS Variables - ä» StyleConfig åŠ¨æ€ç”Ÿæˆ */
        :root {
            {{ css_variables | safe }}
        }

        /* æ¸å˜èƒŒæ™¯ */
        .reveal {
            background: var(--color-background);
            background: var(--color-bg-gradient, var(--color-background));
        }

        /* æ¯›ç»ç’ƒå¡ç‰‡æ•ˆæœ (Glassmorphism) */
        .slide-content,
        .bullets-container,
        .content-bullets,
        .content-steps,
        .comparison-left,
        .comparison-right,
        .grid-item {
            background: var(--color-surface, rgba(255, 255, 255, 0.8));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* æ·±è‰²ä¸»é¢˜ä¸‹çš„æ¯›ç»ç’ƒè°ƒæ•´ */
        .reveal[data-theme="dark"] .slide-content,
        .reveal[data-theme="dark"] .bullets-container {
            background: var(--color-surface, rgba(30, 41, 59, 0.7));
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* å›¾ç‰‡ç”Ÿæˆæ§åˆ¶é¢æ¿ */
        .image-generation-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            min-width: 300px;
        }

        .image-generation-panel h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }

        .image-generation-panel button {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .image-generation-panel button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .image-generation-panel button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .progress-container {
            margin-top: 10px;
            display: none;
        }

        .progress-container.visible {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }

        .progress-status {
            margin-top: 8px;
            font-size: 12px;
            color: #333;
            text-align: center;
        }

        .progress-status.success {
            color: #27ae60;
        }

        .progress-status.warning {
            color: #f39c12;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æ•™æ³•ç¯èŠ‚æ ‡ç­¾ */
        .pedagogy-phase-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            background: var(--color-primary);
            color: white;
            font-size: 12px;
            border-radius: 4px;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- å›¾ç‰‡ç”ŸæˆçŠ¶æ€ç›‘æ§é¢æ¿ -->
    <div class="image-generation-panel" id="imagePanel">
        <h4>ğŸ“Š æ™ºèƒ½é…å›¾çŠ¶æ€</h4>
        <div style="margin-bottom: 10px;">
            <button id="generateImagesBtn" onclick="window.parent.postMessage({type: 'START_IMAGE_GENERATION'}, '*')">
                ğŸš€ å¼€å§‹ç”Ÿæˆæ•™å­¦é…å›¾
            </button>
        </div>
        <div class="progress-container visible" id="imageProgressContainer">
            <div class="progress-bar">
                <div class="progress-bar-fill" id="imageProgressBar"></div>
            </div>
            <div class="progress-text">
                <span id="imageProgressText">0 / {{ total_image_slots }}</span>
                <span id="imageProgressLabel">ç­‰å¾…ç”Ÿæˆ...</span>
            </div>
            <div class="progress-status" id="imageProgressStatus">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹ç”Ÿæˆé…å›¾</div>
        </div>
    </div>

    <div class="reveal">
        <div class="slides">
            {% for slide in slides %}
            {% include 'slide.html' %}
            {% endfor %}
        </div>
    </div>

    <!-- Reveal.js æ ¸å¿ƒè„šæœ¬ -->
    <script src="./static/reveal.js/dist/reveal.js"></script>

    <script>
        // Reveal.js é…ç½® (å¯¼å‡ºå‹å¥½, æ— 3Dæ•ˆæœ)
        Reveal.initialize({
            width: 1920,
            height: 1080,
            margin: 0.04,

            // ç¦ç”¨å¤æ‚åŠ¨ç”»
            transition: 'slide',
            transitionSpeed: 'default',
            backgroundTransition: 'fade',

            // æ§åˆ¶é€‰é¡¹
            controls: true,
            progress: true,
            center: false,
            hash: true,

            // é”®ç›˜å¯¼èˆª
            keyboard: true,
            overview: true,
            touch: true,

            // æ— æ’ä»¶
            plugins: []
        });

        // å›¾ç‰‡çŠ¶æ€æ›´æ–°å‡½æ•° (ä¾›çˆ¶çª—å£è°ƒç”¨)
        window.updateImageProgress = function(done, total, status) {
            const progressBar = document.getElementById('imageProgressBar');
            const progressText = document.getElementById('imageProgressText');
            const progressStatus = document.getElementById('imageProgressStatus');
            
            const percent = total > 0 ? Math.round((done / total) * 100) : 0;
            progressBar.style.width = percent + '%';
            progressText.textContent = done + ' / ' + total;
            progressStatus.textContent = status;
            
            if (done === total && total > 0) {
                progressStatus.classList.add('success');
            }
        };

        // å›¾ç‰‡åŠ è½½å‡½æ•° (ä¾›çˆ¶çª—å£è°ƒç”¨)
        window.loadImage = function(slotId, imageUrl) {
            const placeholder = document.querySelector('[data-slot-id="' + slotId + '"]');
            if (placeholder) {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '8px';
                placeholder.innerHTML = '';
                placeholder.appendChild(img);
            }
        };
    </script>
</body>

</html>
